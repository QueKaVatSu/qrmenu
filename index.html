<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spicy Menu</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React Kütüphaneleri -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel (JSX'i tarayıcıda çalıştırmak için) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Poppins Font */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap');
        body { font-family: 'Poppins', sans-serif; }
        .font-regular { font-weight: 400; }
        .font-medium { font-weight: 500; }
        /* Scrollbar Gizleme */
        .scroll-hidden::-webkit-scrollbar { display: none; }
        .scroll-hidden { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- Ikonlar (SVG olarak) ---
        const MenuIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M4 6h16M4 12h16m-16 6h16" />
          </svg>
        );

        const SearchIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
            <path strokeLinecap="round" strokeLinejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        );

        const BackIcon = ({ className = "h-5 w-5" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
        );
        
        const ClockIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const WeightIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                 <path strokeLinecap="round" strokeLinejoin="round" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
            </svg>
        );

        const FireIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7.014A8.003 8.003 0 0112 2a8.003 8.003 0 016.014 2.986C20.5 5 21 8 21 10c2 1 2.657 2.343 2.657 2.657a8 8 0 01-11.314 6z" />
            </svg>
        );
        
        // --- Yardımcı Fonksiyon (Utility) ---
        const throttle = (func, limit) => {
          let inThrottle;
          return function() {
            const args = arguments;
            const context = this;
            if (!inThrottle) {
              func.apply(context, args);
              inThrottle = true;
              setTimeout(() => (inThrottle = false), limit);
            }
          };
        };

        // --- Örnek Menü Verisi ---
        const menuData = {
          categoryRows: [
            [
              { id: 'c1', name: 'Ara Sıcaklar', subtitle: 'Lezzetli bir başlangıç', width: 170, height: 200, media: 'title1' },
              { id: 'c2', name: 'İçecekler', subtitle: 'Taze ve serinletici', width: 170, height: 200, media: 'title2' }
            ],
            [
              { id: 'c3', name: 'Pizza', subtitle: 'Ekşi maya hamurdan gelen lezzet', width: 205, height: 250, media: 'title3' },
              { id: 'c4', name: 'Salatalar', subtitle: 'Her zaman taze', width: 135, height: 200, media: 'title4' }
            ],
            [ { id: 'c5', name: 'Ana Yemekler', subtitle: 'Şef seçkisi lezzetler', width: 360, height: 200, media: 'title5' } ],
            [
              { id: 'c6', name: 'Şaraplar', subtitle: 'Bağlardan kristal kadehlere', width: 205, height: 250, media: 'title6' },
              { id: 'c7', name: 'Tatlılar', subtitle: 'Mutluluk Tadında Lezzetler', width: 135, height: 200, media: 'title7' }
            ],
            [
              { id: 'c8', name: 'Rakılar', subtitle: 'Muhabbetin Dem Vakti', width: 170, height: 200, media: 'title8' },
              { id: 'c9', name: 'Biralar', subtitle: 'Köpüklü, Soğuk, Lezzetli', width: 170, height: 200, media: 'title9' }
            ],
            [
              { id: 'c10', name: 'Mezeler', subtitle: 'Sofranın Bütün Renkleri', width: 205, height: 250, media: 'title10' },
              { id: 'c11', name: 'Shots', subtitle: 'Hızlı, Cesur, Unutulmaz', width: 135, height: 200, media: 'title11' }
            ]
          ],
          products: {
            'c1': [ { id: 'p1', name: 'Sigara Böreği', description: 'Çıtır çıtır, peynirli.', price: '165 TL', image: 'https://placehold.co/600x400/e9e9e9/333?text=Börek', prepTime: 10, grams: 150, kcal: 300, video: 'product1', tags: ['arasicak'] } ],
            'c2': [ 
                { id: 'p2', name: 'Limonata', description: 'Ev yapımı, taze nane ile.', price: '90 TL', image: 'https://placehold.co/600x400/e9e9e9/333?text=Limonata', prepTime: 5, grams: 300, kcal: 150, video: 'product2', tags: ['icecek', 'alkolsuz'] },
                { id: 'p2-2', name: 'Kola', description: 'Buz gibi.', price: '70 TL', image: 'https://placehold.co/600x400/e9e9e9/333?text=Kola', prepTime: 1, grams: 330, kcal: 140, video: 'product_cola', tags: ['icecek', 'alkolsuz', 'kola'] }
            ],
            'c3': [ { id: 'p3', name: 'Margarita Pizza', description: 'Domates sos, mozzarella ve taze fesleğen.', price: '250 TL', image: 'https://placehold.co/600x400/e9e9e9/333?text=Pizza', prepTime: 25, grams: 500, kcal: 750, video: 'product3', tags: ['pizza'] } ],
            'c4': [ { id: 'p4', name: 'Sezar Salata', description: 'Izgara tavuk parçaları ile.', price: '210 TL', image: 'https://placehold.co/600x400/e9e9e9/333?text=Salata', prepTime: 15, grams: 350, kcal: 450, video: 'product_salad', tags: ['salata'] } ],
            'c5': [
                { id: 'p5-1', name: 'Trüf Burger', description: 'Trüf mayonez ve cheddar peyniri ile', price: '780 TL', image: 'https://placehold.co/150x150/e9e9e9/333?text=Burger', video: 'product1', prepTime: 20, grams: 450, kcal: 900, tags: ['kirmizi-et', 'burger'] },
                { id: 'p5-2', name: 'Kuzu Pirzola', description: 'Izgara sebzeler ve firik pilavı ile', price: '950 TL', image: 'https://placehold.co/150x150/e9e9e9/333?text=Pirzola', video: 'product2', prepTime: 30, grams: 450, kcal: 950, tags: ['kirmizi-et'] },
                { id: 'p5-3', name: 'Izgara Somon', description: 'Kuşkonmaz ve avokado salatası ile', price: '750 TL', image: 'https://placehold.co/150x150/e9e9e9/333?text=Somon', video: 'product3', prepTime: 20, grams: 350, kcal: 650, tags: ['balik'] },
                { id: 'p5-4', name: 'T-Bone Steak', description: '600gr, özel baharatlarla marine edilmiş', price: '1250 TL', image: 'https://placehold.co/150x150/e9e9e9/333?text=Steak', video: 'product4', prepTime: 35, grams: 600, kcal: 1200, tags: ['kirmizi-et', 'steak'] },
                { id: 'p5-5', name: 'Tavuk Külbastı', description: 'Özel baharatlarla marine edilmiş tavuk but', price: '650 TL', image: 'https://placehold.co/150x150/e9e9e9/333?text=Tavuk', video: 'product5', prepTime: 25, grams: 400, kcal: 700, tags: ['beyaz-et', 'tavuk'] },
                { id: 'p5-6', name: 'Antrikot', description: '250gr, dinlendirilmiş dana antrikot', price: '1100 TL', image: 'https://placehold.co/150x150/e9e9e9/333?text=Antrikot', video: 'product6', prepTime: 30, grams: 250, kcal: 850, tags: ['kirmizi-et', 'steak'] },
                { id: 'p5-7', name: 'Kuzu İncik', description: 'Ağır ateşte pişirilmiş, tandır lezzeti', price: '980 TL', image: 'https://placehold.co/150x150/e9e9e9/333?text=İncik', video: 'product7', prepTime: 180, grams: 550, kcal: 1100, tags: ['kirmizi-et'] },
            ],
            'c6': [ { id: 'p6', name: 'Kavaklıdere Yakut', description: 'Klasikleşmiş lezzet.', price: '750 TL', image: 'https://placehold.co/600x400/e9e9e9/333?text=Şarap', prepTime: 1, grams: 750, kcal: 600, video: 'product_wine', tags: ['sarap', 'icecek', 'alkollu'] } ],
            'c7': [], 'c8': [], 'c9': [], 'c10': [], 'c11': [],
          }
        };

        const allProducts = Object.values(menuData.products).flat();
        const findProductById = (id) => allProducts.find(p => p.id === id);

        // --- Bileşenler (Components) ---

        const Header = ({ isSolid, onLogoClick }) => (
          <header 
            className={`
              fixed top-0 left-0 right-0 z-50 flex items-center justify-between px-4 py-1 max-w-md mx-auto h-[64px]
              transition-all duration-300 ease-in-out
              ${isSolid ? 'bg-white shadow-md' : 'bg-transparent'}
            `}
          >
            <button className={`p-2 transition-colors duration-300 ${isSolid ? 'text-gray-800' : 'text-white'}`}>
                <MenuIcon />
            </button>
            <div 
                className={`transition-opacity duration-300 cursor-pointer ${isSolid ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}
                onClick={onLogoClick}
            >
                <img 
                    src="./logo.png" 
                    alt="SpicyMenu Logo" 
                    className="h-14" 
                    onError={(e) => { e.target.onerror = null; e.target.style.display='none'; document.getElementById('logo-text-header').style.display='block'; }}
                />
                <h1 
                    id="logo-text-header" 
                    className={`hidden text-xl font-bold tracking-widest uppercase ${isSolid ? 'text-gray-900' : 'text-white'}`}
                >
                    SpicyMenu
                </h1>
            </div>
            <button className={`p-2 transition-colors duration-300 ${isSolid ? 'text-gray-800' : 'text-white'}`}>
                <SearchIcon />
            </button>
          </header>
        );
        
        const Hero = ({ onScrollClick, isScrolled }) => (
            <div className="relative h-screen w-full overflow-hidden">
                <video src="./hero.webm" autoPlay loop muted playsInline className="absolute top-0 left-0 w-full h-full object-cover z-0"></video>
                <div className="absolute top-0 left-0 w-full h-full bg-black/30 z-10"></div>
                <div className="relative z-20 flex flex-col items-center justify-center h-full px-4">
                    <img
                        src="./logo.png"
                        alt="SpicyMenu Logo"
                        className={`h-56 mb-8 transition-opacity duration-300 ease-in-out drop-shadow-lg ${isScrolled ? 'opacity-0' : 'opacity-100'}`}
                        onError={(e) => { e.target.style.display = 'none'; }}
                    />
                    <button 
                        onClick={onScrollClick}
                        className="font-regular text-white text-lg border border-white/80 rounded-full px-12 py-3 backdrop-blur-sm transition-colors hover:bg-white/20">
                        Menüyü Görüntüle
                    </button>
                </div>
            </div>
        );

        const CategoryCard = ({ category, onSelectCategory, isVisible, index }) => {
            const totalWidthInRow = category.row.reduce((acc, cat) => acc + cat.width, 0);
            const flexBasis = `${(category.width / totalWidthInRow) * 100}%`;

            return (
                <div
                    className={`relative rounded-2xl p-6 flex flex-col justify-end cursor-pointer overflow-hidden text-white shadow-lg bg-gray-200 transition-all duration-700 ease-out
                        ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-5'}
                    `}
                    style={{ 
                        flexBasis: flexBasis, 
                        aspectRatio: `${category.width} / ${category.height}`,
                        transitionDelay: `${index * 100}ms`
                    }}
                    onClick={() => onSelectCategory(category.id)}
                >
                    <video 
                        src={`./${category.media}.webm`} 
                        onError={(e) => e.target.style.display = 'none'}
                        autoPlay loop muted playsInline 
                        className="absolute top-0 left-0 w-full h-full object-cover z-0"
                    ></video>
                    <img 
                        src={`./${category.media}.png`} 
                        alt={category.name} 
                        onError={(e) => e.target.style.display = 'none'}
                        className="absolute top-0 left-0 w-full h-full object-cover z-0"
                    />
                    
                    <div className="absolute top-0 left-0 w-full h-full bg-black/30 z-10"></div>
                    <div className="relative z-20">
                        <h2 className="text-2xl font-medium">{category.name}</h2>
                        <p className="text-sm font-regular opacity-90">{category.subtitle}</p>
                    </div>
                </div>
            );
        };

        const CategoryPage = ({ onSelectCategory, menuRef, isVisible }) => {
            let cardIndex = 0;
            return (
                <div ref={menuRef} className="p-4 flex flex-col gap-4 bg-gray-100" style={{ scrollMarginTop: '64px' }}>
                    {menuData.categoryRows.map((row, rowIndex) => (
                        <div key={rowIndex} className="flex gap-4">
                            {row.map(category => (
                                <CategoryCard 
                                    key={category.id} 
                                    category={{...category, row}} 
                                    onSelectCategory={onSelectCategory}
                                    isVisible={isVisible}
                                    index={cardIndex++}
                                />
                            ))}
                        </div>
                    ))}
                </div>
            );
        };

        const ProductListPage = ({ selectedCategory, onGoBack, onSelectCategory, onSelectProduct }) => {
          const products = menuData.products[selectedCategory] || [];
          const allCategories = menuData.categoryRows.flat();
          
          const activeCategory = allCategories.find(c => c.id === selectedCategory);
          const inactiveCategories = allCategories.filter(c => c.id !== selectedCategory);
          const sortedCategories = activeCategory ? [activeCategory, ...inactiveCategories] : allCategories;

          return (
            <div className="bg-gray-100 min-h-full pt-[64px]">
              <nav className="sticky top-[64px] z-30 bg-white overflow-x-auto whitespace-nowrap scroll-hidden w-full max-w-md">
                <div className="flex items-center p-4 border-b border-gray-200">
                    <button onClick={onGoBack} className="p-2 mr-2">
                        <BackIcon className="h-6 w-6 text-gray-600"/>
                    </button>
                    {sortedCategories.map(cat => (
                         <button 
                            key={cat.id}
                            onClick={() => onSelectCategory(cat.id)}
                            className={`flex-shrink-0 px-3 py-2 text-sm transition-colors duration-300 ${selectedCategory === cat.id ? 'font-medium text-gray-900' : 'font-regular text-gray-500'}`}>
                            {cat.name}
                        </button>
                    ))}
                </div>
              </nav>
              <div className="p-4 space-y-4">
                {products.length > 0 ? products.map(product => (
                  <div key={product.id} onClick={() => onSelectProduct(product)} className="flex items-center p-4 bg-white rounded-2xl cursor-pointer shadow-sm">
                    <div className="flex-1 pr-4">
                      <h3 className="text-lg font-medium text-gray-800">{product.name}</h3>
                      <p className="text-sm font-regular text-gray-600 mb-2">{product.description}</p>
                      <p className="text-md font-medium text-gray-900">{product.price}</p>
                    </div>
                    <img src={product.image} alt={product.name} className="w-28 h-28 rounded-lg object-cover" />
                  </div>
                )) : (
                    <div className="text-center py-16"><p className="text-gray-500">Bu kategoride henüz ürün bulunmuyor.</p></div>
                )}
              </div>
            </div>
          );
        };
        
        const MainCoursePage = ({ selectedCategory, onGoBack, onSelectCategory, onSelectProduct }) => {
            const products = menuData.products[selectedCategory] || [];
            const allCategories = menuData.categoryRows.flat();
            const activeCategory = allCategories.find(c => c.id === selectedCategory);
            const inactiveCategories = allCategories.filter(c => c.id !== selectedCategory);
            const sortedCategories = activeCategory ? [activeCategory, ...inactiveCategories] : allCategories;
            
            const reelsRef = React.useRef(null);
            const scrollIntervalRef = React.useRef(null);
            const [activeReelIndex, setActiveReelIndex] = React.useState(0);

            const startScrolling = React.useCallback(() => {
                if (scrollIntervalRef.current) return;
                scrollIntervalRef.current = setInterval(() => {
                    if (reelsRef.current) {
                        const { scrollLeft, scrollWidth } = reelsRef.current;
                        if (scrollLeft >= (scrollWidth * 0.66)) { 
                            reelsRef.current.style.scrollBehavior = 'auto';
                            reelsRef.current.scrollLeft = scrollLeft - (scrollWidth / 3);
                            reelsRef.current.style.scrollBehavior = 'smooth';
                        }
                        reelsRef.current.scrollLeft += 0.5;
                    }
                }, 25);
            }, []);

            const stopScrolling = React.useCallback(() => {
                clearInterval(scrollIntervalRef.current);
                scrollIntervalRef.current = null;
            }, []);

            React.useEffect(() => {
                startScrolling();
                return () => stopScrolling();
            }, [startScrolling, stopScrolling]);

            const handleScroll = React.useCallback(() => {
                if (!reelsRef.current) return;
                const container = reelsRef.current;
                const scrollLeft = container.scrollLeft;
                const itemWidth = container.children[0] ? container.children[0].offsetWidth + 16 : 0;
                
                if (itemWidth > 0) {
                    const firstItemIndex = Math.round(scrollLeft / itemWidth);
                    const newIndex = firstItemIndex + 1;
                    setActiveReelIndex(newIndex % products.length);
                }
            }, [products.length]);

            const throttledHandleScroll = React.useMemo(() => throttle(handleScroll, 50), [handleScroll]);

            React.useEffect(() => {
                const container = reelsRef.current;
                if (container) {
                    container.addEventListener('scroll', throttledHandleScroll, { passive: true });
                    throttledHandleScroll();
                }
                return () => {
                    if (container) {
                        container.removeEventListener('scroll', throttledHandleScroll);
                    }
                };
            }, [throttledHandleScroll]);
            
            const duplicatedProducts = [...products, ...products, ...products];

            return (
                <div className="bg-gray-100 min-h-full pt-[64px]">
                    <nav className="sticky top-[64px] z-30 bg-white overflow-x-auto whitespace-nowrap scroll-hidden w-full max-w-md">
                        <div className="flex items-center p-4 border-b border-gray-200">
                            <button onClick={onGoBack} className="p-2 mr-2">
                                <BackIcon className="h-6 w-6 text-gray-600"/>
                            </button>
                            {sortedCategories.map(cat => (
                                <button 
                                    key={cat.id}
                                    onClick={() => onSelectCategory(cat.id)}
                                    className={`flex-shrink-0 px-3 py-2 text-sm transition-colors duration-300 ${selectedCategory === cat.id ? 'font-medium text-gray-900' : 'font-regular text-gray-500'}`}>
                                    {cat.name}
                                </button>
                            ))}
                        </div>
                    </nav>

                    <div>
                        {/* Reels Section */}
                        <div
                            ref={reelsRef}
                            onMouseDown={stopScrolling} onTouchStart={stopScrolling}
                            onMouseUp={startScrolling} onTouchEnd={startScrolling}
                            onMouseLeave={startScrolling}
                            className="flex overflow-x-auto scroll-hidden px-4 py-8 space-x-4 items-center cursor-grab active:cursor-grabbing"
                            style={{ scrollSnapType: 'x mandatory' }}
                        >
                            {duplicatedProducts.map((product, index) => (
                                <div 
                                    key={`${product.id}-${index}`}
                                    className={`flex-shrink-0 w-32 text-center transition-transform duration-300 ease-in-out`}
                                    style={{ scrollSnapAlign: 'center' }}
                                    onClick={() => onSelectProduct(product)}
                                >
                                    <div className={`relative w-full h-48 rounded-2xl overflow-hidden shadow-lg transform transition-transform duration-300 ease-in-out ${activeReelIndex === index % products.length ? 'scale-110' : 'scale-100'}`}>
                                         <video src={`./${product.video}.webm`} autoPlay loop muted playsInline className="absolute top-0 left-0 w-full h-full object-cover z-0"></video>
                                         <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                                         <div className="absolute bottom-0 left-0 p-3 text-white">
                                             <h3 className="font-medium text-sm">{product.name}</h3>
                                             <p className="text-xs font-regular">{product.price}</p>
                                         </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Story Section */}
                        <div className="p-4 pt-0">
                            <div className="bg-white rounded-2xl p-6 shadow-sm">
                                <h3 className="text-xl font-medium text-gray-800">Ana Menüden Bir Yemeğin Hikayesi</h3>
                                <p className="text-gray-600 mt-2 font-regular">Her bir tabağımız, şeflerimizin özenle seçtiği yerel ve taze malzemelerle hazırlanır. Bu lezzet yolculuğunu keşfedin.</p>
                                <button className="mt-4 text-sm font-medium text-gray-800 border border-gray-400 rounded-full px-5 py-2 hover:bg-gray-100 transition-colors">
                                    KEŞFET
                                </button>
                            </div>
                        </div>

                        {/* Product List */}
                        <div className="p-4 space-y-4">
                            {products.map(product => (
                                <div key={product.id} onClick={() => onSelectProduct(product)} className="flex items-center p-4 bg-white rounded-2xl cursor-pointer shadow-sm">
                                    <div className="flex-1 pr-4">
                                        <h3 className="text-lg font-medium text-gray-800">{product.name}</h3>
                                        <p className="text-sm font-regular text-gray-600 mb-2">{product.description}</p>
                                        <p className="text-md font-medium text-gray-900">{product.price}</p>
                                    </div>
                                    <div className="w-28 h-28 rounded-lg object-cover overflow-hidden flex-shrink-0 bg-gray-200">
                                        <video src={`./${product.video}.webm`} autoPlay loop muted playsInline className="w-full h-full object-cover" onError={(e) => e.target.style.display='none'}></video>
                                        <img src={product.image} alt={product.name} className="w-full h-full object-cover" onError={(e) => e.target.style.display='none'}/>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };
        
        const ProductDetailPage = ({ product, onGoBack }) => {
            if (!product) return null;
            
            const getRecommendations = (p) => {
                if (!p.tags) return [];
                let recommendations = [];
                if (p.tags.includes('kirmizi-et') && !p.tags.includes('burger')) {
                    recommendations = allProducts.filter(item => item.tags && item.tags.includes('sarap'));
                } else if (p.tags.includes('balik') || p.tags.includes('tavuk')) {
                    recommendations = allProducts.filter(item => item.tags && item.tags.includes('salata'));
                } else if (p.tags.includes('pizza') || p.tags.includes('burger')) {
                    recommendations = allProducts.filter(item => item.tags && item.tags.includes('kola'));
                }
                return recommendations.slice(0, 2); // En fazla 2 öneri göster
            };

            const recommendations = getRecommendations(product);

            return (
                <div className="bg-gray-100 min-h-full" style={{ WebkitOverflowScrolling: 'touch' }}>
                    <div className="relative h-[30rem] overflow-hidden rounded-b-3xl bg-gray-200">
                        {product.video ? (
                            <video src={`./${product.video}.webm`} autoPlay loop muted playsInline className="absolute top-0 left-0 w-full h-full object-cover"></video>
                        ) : (
                            <img src={product.image} alt={product.name} className="absolute top-0 left-0 w-full h-full object-cover" />
                        )}
                         <button onClick={onGoBack} className="absolute top-4 left-4 bg-white/80 p-2 rounded-full shadow-md z-30">
                            <BackIcon className="h-6 w-6 text-gray-800" />
                        </button>
                    </div>
                    <div className="p-6">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <h2 className="text-3xl font-medium text-gray-900">{product.name}</h2>
                                <p className="text-md font-regular text-gray-600">{product.description}</p>
                            </div>
                            <p className="text-2xl font-medium text-gray-900 whitespace-nowrap ml-4">{product.price}</p>
                        </div>
                        <div className="flex justify-around bg-white p-4 rounded-2xl shadow-sm text-center text-gray-600">
                            <div className="flex flex-col items-center"><ClockIcon /> <span className="font-medium">{product.prepTime}</span> dakika</div>
                            <div className="flex flex-col items-center"><WeightIcon /> <span className="font-medium">{product.grams}</span> gram</div>
                            <div className="flex flex-col items-center"><FireIcon /> <span className="font-medium">{product.kcal}</span> kcal</div>
                        </div>

                        {recommendations.length > 0 && (
                            <div className="mt-8">
                                <h3 className="text-xl font-medium text-gray-800 mb-4">Birlikte İyi Gider</h3>
                                <div className="space-y-4">
                                    {recommendations.map(rec => (
                                        <div key={rec.id} className="flex items-center p-4 bg-white rounded-2xl shadow-sm">
                                            <img src={rec.image} alt={rec.name} className="w-16 h-16 rounded-lg object-cover mr-4" />
                                            <div className="flex-1">
                                                <h4 className="font-medium text-gray-800">{rec.name}</h4>
                                                <p className="text-sm text-gray-500">{rec.price}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        function App() {
          const [page, setPage] = React.useState('categories');
          const [selectedCategory, setSelectedCategory] = React.useState(null);
          const [selectedProduct, setSelectedProduct] = React.useState(null);
          const [isHeaderSolid, setIsHeaderSolid] = React.useState(false);
          const [isMenuVisible, setIsMenuVisible] = React.useState(false);
          const menuRef = React.useRef(null);
          const scrollContainerRef = React.useRef(null);

          const updatePage = (newPage, pushState = true) => {
              if (pushState) {
                  const state = { page: newPage, category: selectedCategory, product: selectedProduct };
                  window.history.pushState(state, '');
              }
              setPage(newPage);
          };

          React.useEffect(() => {
            const handlePopState = (event) => {
                if (event.state && event.state.page) {
                    setPage(event.state.page);
                    setSelectedCategory(event.state.category);
                    setSelectedProduct(event.state.product);
                } else {
                    setPage('categories'); // Fallback to the initial page
                }
            };

            window.addEventListener('popstate', handlePopState);
            // Push initial state
            window.history.replaceState({ page: 'categories', category: null, product: null }, '');

            return () => {
                window.removeEventListener('popstate', handlePopState);
            };
          }, []);

          React.useEffect(() => {
            const container = scrollContainerRef.current;
            if (!container) return;
            const handleScroll = () => {
              const scrollTop = container.scrollTop;
              setIsHeaderSolid(scrollTop > 50);

              if (menuRef.current && !isMenuVisible) {
                if (menuRef.current.getBoundingClientRect().top < window.innerHeight * 0.85) {
                    setIsMenuVisible(true);
                }
              }
            };
            container.addEventListener('scroll', handleScroll, { passive: true });
            return () => container.removeEventListener('scroll', handleScroll);
          }, [isMenuVisible]);

          const handleLogoClick = () => {
              updatePage('categories');
              setTimeout(() => {
                  scrollContainerRef.current?.scrollTo({ top: 0, behavior: 'smooth' });
              }, 50);
          };
          const handleScrollToMenu = () => {
            menuRef.current?.scrollIntoView({ behavior: 'smooth' });
            setTimeout(() => setIsMenuVisible(true), 100);
          };
          const handleSelectCategory = (categoryId) => { 
              setSelectedCategory(categoryId); 
              const state = { page: 'products', category: categoryId, product: null };
              window.history.pushState(state, '');
              setPage('products');
          };
          const handleSelectProduct = (product) => { 
              setSelectedProduct(product); 
              const state = { page: 'productDetail', category: selectedCategory, product: product };
              window.history.pushState(state, '');
              setPage('productDetail');
          };
          const goBackToCategories = () => window.history.back();
          const goBackToProducts = () => window.history.back();

          const getPageTransform = () => {
            if (page === 'products') return '-translate-x-full';
            if (page === 'productDetail') return '-translate-x-[200%]';
            return 'translate-x-0';
          };
          
          const ProductPage = () => {
              if (!selectedCategory) return null;
              
              if (selectedCategory === 'c5') { // Ana Yemekler
                  return <MainCoursePage selectedCategory={selectedCategory} onGoBack={goBackToCategories} onSelectCategory={handleSelectCategory} onSelectProduct={handleSelectProduct} />;
              }
              
              return <ProductListPage selectedCategory={selectedCategory} onGoBack={goBackToCategories} onSelectCategory={handleSelectCategory} onSelectProduct={handleSelectProduct} />;
          };

          return (
              <div className="bg-gray-100 min-h-screen max-w-md mx-auto">
                {page !== 'productDetail' && <Header isSolid={isHeaderSolid || page !== 'categories'} onLogoClick={handleLogoClick} />}
                <main className="relative w-full h-screen overflow-hidden">
                  <div className={`flex transition-transform duration-500 ease-in-out h-full ${getPageTransform()}`}>
                    
                    <div ref={scrollContainerRef} className="w-full flex-shrink-0 h-full overflow-y-auto scroll-hidden bg-white">
                        <Hero onScrollClick={handleScrollToMenu} isScrolled={isHeaderSolid} />
                        <CategoryPage onSelectCategory={handleSelectCategory} menuRef={menuRef} isVisible={isMenuVisible} />
                    </div>

                    <div className="w-full flex-shrink-0 h-full overflow-y-auto scroll-hidden">
                      <ProductPage />
                    </div>
                    
                    <div className="w-full flex-shrink-0 h-full overflow-y-auto" style={{ WebkitOverflowScrolling: 'touch' }}>
                      <ProductDetailPage product={selectedProduct} onGoBack={goBackToProducts} />
                    </div>

                  </div>
                </main>
              </div>
          );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>

